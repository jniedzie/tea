<h1 id="welcome-to-tea">Welcome to TEA!</h1>

<h2 id="introduction">Introduction</h2>
<p>TEA stands for Toolkit for Efficient Analysis. It is a set of loop-based tools built in C++ and Python, which will help you with:</p>
<ul>
  <li>reading any kind of flat ntuples stored in ROOT files (e.g. NanoAOD or HEPMC converted to ROOT),</li>
  <li>applying selections,</li>
  <li>saving skimmed trees,</li>
  <li>creating cut flow tables,</li>
  <li>creating histograms,</li>
  <li>plotting histograms.</li>
</ul>

<p>Upcoming features:</p>
<ul>
  <li>submission to HTCondor based grid systems (e.g. lxplus or NAF),</li>
  <li>optimization and verification of ABCD method for background estimation,</li>
  <li>estimation of systematic uncertainties,</li>
  <li>applying correction (e.g. Jet Energy Corrections, Jet Energy Resolution, Pile-Up reweighting, etc.),</li>
  <li>calculating limits with Combine,</li>
</ul>

<p>For these instructions we will use a scenario in which you start working on a ttH analysis.</p>

<h2 id="getting-started">Getting started</h2>

<h3 id="repositories-setup">Repositories setup</h3>

<p>We highly recommend that you keep your analysis code in a git repository, while (optionally) downloading updates in the TEA framework from our repository. In order to do that:</p>

<ol>
  <li>Create your analysis repository on github (go to your profile -&gt; repositories -&gt; new, pick a suitable name and create). Don’t add any README, licence or gitignore.</li>
  <li>Create an empty directory for your analysis:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>tea_ttH_analysis
<span class="nb">cd </span>tea_ttH_analysis
</code></pre></div>    </div>
  </li>
  <li>Clone TEA repository:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/jniedzie/tea.git <span class="nb">.</span>
</code></pre></div>    </div>
  </li>
  <li>Setup git remotes:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote set-url origin git@github.com:your_username/your_repo.git
git remote add upstream git@github.com:jniedzie/tea.git
git push origin main
</code></pre></div>    </div>
  </li>
</ol>

<p>Now you can regularly push to your repository:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add path_to_file
git commit <span class="nt">-m</span> <span class="s2">"Commit message"</span>
git push origin main
</code></pre></div></div>

<p>while from time to time you can also pull changes from TEA repository:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull <span class="nt">--rebase</span> upstream main
</code></pre></div></div>

<p>Keep in mind that if you modify parts for the framework itself, you will have to resolve conflicts when updating TEA.
You can (and should!) modify README.md though - it will be ignored when pulling changes from upstream.</p>

<h3 id="conda-environment">Conda environment</h3>

<p>To make sure you’re using supported versions of Python and ROOT, we recommend to craete a conda environment for TEA:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create <span class="nt">-c</span> conda-forge <span class="nt">--name</span> tea root <span class="nv">python</span><span class="o">=</span>3.8
conda activate tea
</code></pre></div></div>

<h3 id="building-and-running-the-project">Building and running the project</h3>

<p>Building TEA together with your analysis files is very straighforward:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir build
cd build
cmake ..
make -j install
</code></pre></div></div>

<p>Once compiled, you can execute any of the apps directly from the <code class="language-plaintext highlighter-rouge">bin</code> directory (all configs will also be installed in this directory), e.g. <code class="language-plaintext highlighter-rouge">./skimmer skimmer_config.py</code>.</p>

<h2 id="general-concepts">General concepts</h2>

<p>TEA has a very simple structure, with libraries, apps and configs:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\apps
  \examples
  \ttH_analysis
\configs
  \examples
  \ttH_analysis
\libs
  \core
  \extensions
  \histogramming
</code></pre></div></div>

<h3 id="apps">Apps</h3>

<p>The <code class="language-plaintext highlighter-rouge">apps</code> directory contains apps, which use the library to perform certain tasks, such as skimming the data or creating histograms. Whenever you want to implement a new app, you will simply call the <code class="language-plaintext highlighter-rouge">create.py</code> script first to create a skeleton for your new app:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python craete.py --type app --name ttH_loose_skimming --path ttH_analysis
</code></pre></div></div>

<p>This will automatically create required directories, a C++ file, and a Python config. You also don’t need to worry about CMake, linking or any of these things - it will work automagically.
Once you create your app, you can open your C++ file from <code class="language-plaintext highlighter-rouge">apps/ttH_analysis/ttH_loose_skimming.cpp</code> and the config from <code class="language-plaintext highlighter-rouge">configs/ttH_analysis/ttH_loose_skimming.py</code>.</p>

<p>In the <code class="language-plaintext highlighter-rouge">apps/examples</code> directory you will find some ideas for how to fill in your C++ file. You can use a number of tools such as event reader/writer, config manager, histogram handler or profiler to achieve your task. In most cases, your <code class="language-plaintext highlighter-rouge">main</code> function will contain a loop over events, in which
you will apply selections, fill histograms, or add events to the output file.</p>

<h3 id="configs">Configs</h3>

<p>Configs in TEA are written in Python, which allows to generate some settings programatically (e.g. imagine you want to create a large number of histograms with names <code class="language-plaintext highlighter-rouge">hist1</code>, <code class="language-plaintext highlighter-rouge">hist2</code>, <code class="language-plaintext highlighter-rouge">hist3</code>, etc. - you can do that in a loop). It also means you don’t have to recompile anything when changing some options.</p>

<h3 id="libs">Libs</h3>

<p>Directories like <code class="language-plaintext highlighter-rouge">core</code> and <code class="language-plaintext highlighter-rouge">histogramming</code> contain C++ classes which you can use to implement your analysis. The <code class="language-plaintext highlighter-rouge">extensions</code> directory contains some general-purpose tools, but is also the place where you can add your own classes. In order to do that, use the <code class="language-plaintext highlighter-rouge">create.py</code> script:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python craete.py --type HistogramFiller --name tthHistogramFiller
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python craete.py --type PhysicsObject --name TopQuark
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python craete.py --type Event --name tthEvent
</code></pre></div></div>

<p>Depending on what kind of functionality you need, you may choose to create a HistogramFiller, a PhysicsObject, or an Event.</p>

<p>[add more explanation here]</p>

